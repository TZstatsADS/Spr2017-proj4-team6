---
title: "Script to test feature extraction"
output: html_notebook
---

### Step 0: Setup project directory
First we have to construct a citation vector from the co-author column of our dataset
```{r "setup", include=TRUE}
require("knitr")
opts_knit$set(root.dir = normalizePath(".."))
projDir <- opts_knit$get("root.dir")
projDir
```

### Step 1: Create document term matrix
We use the `tm` package to create a corpus of the title strings.
```{r}
source('lib/feature_extraction.R')
exFilePath <- file.path(projDir,'output','JRobinson.csv')
dtm <- createDocumentTermMatrix(exFilePath)
```

### Step 2: Tidy the document term matrix
The `tidytext` package allows us to reformat a `tm::DocumentTermMatrix` object into a tidy data frame.
```{r}
cdtm <- dtm %>%
  count(term)

gdtm <- dtm %>%
  group_by(term) %>%
  count(document)
```

### Step 3: Cosine similarity
$$
similarity = cos(\theta) = \frac{A \cdot B}{\begin{Vmatrix}A\end{Vmatrix} \begin{Vmatrix}B\end{Vmatrix}} = \frac{\sum_{i=1}^n A_i B_i}{\sqrt{\sum_{i=1}^n A_i^2} \sqrt{\sum_{i=1}^n B_i^2}}
$$
```{r}

```


```{r}

tb_author <- AKumar %>%
  tbl_df() %>%
  select(PaperID, AuthorID, Coauthor) %>%
  unnest_tokens(Author, Coauthor, token = stringr::str_split, pattern = '[;,]')

tb_title <- AKumar %>%
  tbl_df() %>%
  select(PaperID, AuthorID, Paper) %>%
  unnest_tokens(Words, Paper, token = "words", to_lower = TRUE, drop = TRUE)
  
tb_publication <- AKumar %>%
  tbl_df() %>%
  select(PaperID, AuthorID, Journal)

```


```{r}
test_case <- str_trim(unlist(str_split(authors[5],'[;,]')), side=c("both"))

x <- c()
for(i in 1:length(authors)){
  x <- append(x,str_split(authors[i],'[;,]'))
}
citationVocab <- unlist(x)
citationVocab <- str_trim(citationVocab, side=c("both"))
citationVocab <- unique(citationVocab)
```


```{r}
library(tidytext)
library(tibble)
titles <- as_tibble(AKumar$Paper, AKumar$PaperID)
paper_words <- titles %>%
  unnest_tokens(word,value) %>%
  count()

```


```{r}
source('lib/feature_extraction.R')
term_frequency <- tf(test_case, citationVocab)

```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.
```{r}

```

```{r}

```


```{r}


citation_vector <- c("A Kumar","L Zhao","T Camp",
                     "M Stonebraker","M Rabinovich","E Stohr",
                     "V Christophedes","R Hull","J Simeon") # citation vector
M <- c(0,0,0,
       0,1,0,
       0,0,1) # Rabinovich and Simeon appear as co-authors in citation M

v <- length(citation_vector) # vocab size
```

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file).
